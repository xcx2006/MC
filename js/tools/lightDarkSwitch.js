import{main}from"../main.js";const elementCode=".mermaid";const saveOriginalData=function(){return new Promise(((e,t)=>{try{var i=document.querySelectorAll(elementCode),o=i.length;i.forEach((t=>{t.setAttribute("data-original-code",t.innerHTML);o--;if(o==0){e()}}))}catch(e){t(e)}}))};const resetProcessed=function(){return new Promise(((e,t)=>{try{var i=document.querySelectorAll(elementCode),o=i.length;i.forEach((t=>{if(t.getAttribute("data-original-code")!=null){t.removeAttribute("data-processed");t.innerHTML=t.getAttribute("data-original-code")}o--;if(o==0){e()}}))}catch(e){t(e)}}))};export const ModeToggle={modeToggleButton_dom:null,iconDom:null,mermaidLightTheme:null,mermaidDarkTheme:null,async mermaidInit(e){if(window.mermaid){await resetProcessed();mermaid.initialize({theme:e});mermaid.init({theme:e},document.querySelectorAll(elementCode))}},enableLightMode(){document.body.classList.remove("dark-mode");document.documentElement.classList.remove("dark");document.body.classList.add("light-mode");document.documentElement.classList.add("light");this.iconDom.className="fa-regular fa-moon";main.styleStatus.isDark=false;main.setStyleStatus();this.mermaidInit(this.mermaidLightTheme);this.setGiscusTheme()},enableDarkMode(){document.body.classList.remove("light-mode");document.documentElement.classList.remove("light");document.body.classList.add("dark-mode");document.documentElement.classList.add("dark");this.iconDom.className="fa-regular fa-brightness";main.styleStatus.isDark=true;main.setStyleStatus();this.mermaidInit(this.mermaidDarkTheme);this.setGiscusTheme()},async setGiscusTheme(e){if(document.querySelector("#giscus-container")){let t=document.querySelector("iframe.giscus-frame");while(!t){await new Promise((e=>setTimeout(e,1e3)));t=document.querySelector("iframe.giscus-frame")}while(t.classList.contains("giscus-frame--loading"))await new Promise((e=>setTimeout(e,1e3)));e??=main.styleStatus.isDark?"dark":"light";t.contentWindow.postMessage({giscus:{setConfig:{theme:e}}},"https://giscus.app")}},isDarkPrefersColorScheme(){return window.matchMedia&&window.matchMedia("(prefers-color-scheme: dark)")},initModeStatus(){const e=main.getStyleStatus();if(e){e.isDark?this.enableDarkMode():this.enableLightMode()}else{this.isDarkPrefersColorScheme().matches?this.enableDarkMode():this.enableLightMode()}},initModeToggleButton(){this.modeToggleButton_dom.addEventListener("click",(()=>{const e=document.body.classList.contains("dark-mode");e?this.enableLightMode():this.enableDarkMode()}))},initModeAutoTrigger(){const e=this.isDarkPrefersColorScheme();e.addEventListener("change",(e=>{e.matches?this.enableDarkMode():this.enableLightMode()}))},async init(){this.modeToggleButton_dom=document.querySelector(".tool-dark-light-toggle");this.iconDom=document.querySelector(".tool-dark-light-toggle i");this.mermaidLightTheme=typeof theme.mermaid!=="undefined"&&typeof theme.mermaid.style!=="undefined"&&typeof theme.mermaid.style.light!=="undefined"?theme.mermaid.style.light:"default";this.mermaidDarkTheme=typeof theme.mermaid!=="undefined"&&typeof theme.mermaid.style!=="undefined"&&typeof theme.mermaid.style.dark!=="undefined"?theme.mermaid.style.dark:"dark";this.initModeStatus();this.initModeToggleButton();this.initModeAutoTrigger();try{await saveOriginalData().catch(console.error)}catch(e){}}};export default function initModeToggle(){ModeToggle.init()}